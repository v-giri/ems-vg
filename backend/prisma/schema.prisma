// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  name      String
  role      String    @default("employee") // admin, manager, employee
  createdAt DateTime  @default(now())
  
  // Link to Employee Profile (Optional for admin, required for employees)
  employeeId BigInt?  @unique
  employee   Employee? @relation(fields: [employeeId], references: [id])
}

model Employee {
  id         BigInt   @id // Using BigInt to match your manual IDs or use @default(autoincrement())
  name       String
  position   String
  department String
  salary     Float
  managerId  BigInt?
  
  manager      Employee?  @relation("ManagerSubordinates", fields: [managerId], references: [id])
  subordinates Employee[] @relation("ManagerSubordinates")
  
  user       User?
  attendance Attendance[]
  leaves     LeaveRequest[]
  payroll    PayrollSlip[]
  tasks      Task[]
}

model Attendance {
  id         BigInt   @id @default(autoincrement())
  employeeId BigInt
  employee   Employee @relation(fields: [employeeId], references: [id])
  date       String
  status     String
}

model LeaveRequest {
  id         BigInt   @id @default(autoincrement())
  employeeId BigInt
  employee   Employee @relation(fields: [employeeId], references: [id])
  startDate  String
  endDate    String
  reason     String
  status     String   @default("pending")
}

model PayrollSlip {
  id         BigInt   @id @default(autoincrement())
  employeeId BigInt
  employee   Employee @relation(fields: [employeeId], references: [id])
  salary     Float
  deductions Float
  bonuses    Float
  netPay     Float
  date       String
}

model Task {
  id          BigInt   @id @default(autoincrement())
  employeeId  BigInt
  employee    Employee @relation(fields: [employeeId], references: [id])
  assignedBy  BigInt
  description String
  status      String   @default("pending")
  deadline    String
}